!function(t,e){"use strict";if(!t.ui.HierarchicalSelect){var i=function(){this.initialize.apply(this,arguments)};i.prototype={_errorMessages:{rootStructureIncorrect:'Hierarchical Select Error: Data structure for root select group is incorrect. Please use as data something like: \n{\n\t0: [\n\t\t{\n\t\t\tkey: 97,\n\t\t\ttitle: "Air Conditioners",\n\t\t\tfolder: true,\n\t\t\tselected: false\n\t\t},\n\t\t{\n\t\t\tkey: 531,\n\t\t\ttitle: "Conditioning",\n\t\t\tfolder: false,\n\t\t\tselected: false\n\t\t}\n\t]\n}\n',ajaxRouteEmpty:"Hierarchical Select Error: AJAX route is not set."},initialize:function(t){this._initWidgetOptions(t),this._initHtml(),this._initSliderVariables(),this._initConstants(),this._initSelectGroups(),this._initEvents()},_initWidgetOptions:function(e){return this.$widget=e,this.options=e.options,this.element=e.element,this.$select=t(e.options.select),this._selectedOptionsInSelectGroups=[],this.searchPlaceholder=this.options.searchPlaceholder,this.displayedSelects=this.options.displayedSelects||[0],this.data=this.options.data||null,this._hasDataStructure(this.data[0])?(this.ajaxRoute=this.options.ajaxRoute||"",""==this.ajaxRoute?(console.error(this._errorMessages.ajaxRouteEmpty),!1):void 0):(console.error(this._errorMessages.rootStructureIncorrect),!1)},_initHtml:function(){this.element.addClass("hierarchical").html('<button type="button" class="controls prev disabled fa fa-chevron-left"></button><button type="button" class="controls next disabled fa fa-chevron-right"></button><div class="row hierarchical-overflow-container"><div class="hierarchical-items-container"></div></div>'),this.$btnNext=this.element.find(".next"),this.$btnPrev=this.element.find(".prev"),this.$overflowContainer=this.element.find(".hierarchical-overflow-container"),this.$containerItems=this.element.find(".hierarchical-items-container")},_initSliderVariables:function(){this.currentPos=0,this.outsideLeftPosition=0,this.currentMaxVisibleItems=0,this.itemWidth=0,this.itemOuterWidth=0,this.visibleRemainingWidthOfItem=0},_initConstants:function(){this.ANIMATE_TIME=100,this.MOUSE_UP_DELAY=150,this.TAB_KEY_CODE=9,this.LEFT_ARROW_KEY_CODE=37,this.RIGHT_ARROW_KEY_CODE=39},_initSelectGroups:function(){var e=this,i=0;t.each(e.displayedSelects,function(t,s){e._newSelectGroup(i,e.data[s]),i++})},_initEvents:function(){var i=this;i.$btnNext.on("click",function(){i._next()}),i.$btnPrev.on("click",function(){i._prev()}),i.$overflowContainer.on("scroll",function(){i._onScroll()}).on("mousedown",function(t){if(2==t.which)return t.preventDefault(),t.stopPropagation(),!1}),t(document).on("keydown keypress keyup",function(e){-1!==t.inArray(e.which,[i.TAB_KEY_CODE,i.LEFT_ARROW_KEY_CODE,i.RIGHT_ARROW_KEY_CODE])&&setTimeout(function(){i._onMouseUp()},i.MOUSE_UP_DELAY)}),i.element.parents(".widget-box").find('a[data-action="collapse"]').on("click",function(){setTimeout(function(){i._updateWidths()},i.MOUSE_UP_DELAY)}),t(e).on("resize",function(){i._updateWidths()})},_newSelectGroup:function(t,e){var i=this._createSelectGroup(t,e);this._addSelectGroupEvents(i,e),this.$containerItems.append(i),this._isFirstSelectGroup()&&(this.$firstSelectGroup=this.$containerItems.find(".hierarchical-select-group").eq(0)),this._unblockAllSelectGroups(),this.currentPos=this._getNoOfExistingGroups(),this._updateWidths(),this.$btnNext.addClass("disabled"),this._animateAction("append")},_createSelectGroup:function(e,i){var s=this,n=t('<div class="hierarchical-select-group col-xs-12 col-sm-6 col-md-4 col-lg-3"><div class="hierarchical-select-group-search-container"><input type="text" class="hierarchical-select-group-search form-control" placeholder="'+this.searchPlaceholder+'"><span class="fa fa-search form-control-feedback" aria-hidden="true"></span></div><select data-key="'+e+'" size="6" class="hierarchical-select-group-select form-control"></select></div>'),o=n.find(".hierarchical-select-group-select");return t.each(i,function(t,e){s._createSelectOption(o,e.key,e.title,e.selected,e.folder)}),t(n)},_addSelectGroupEvents:function(t,e){var i=t.find(".hierarchical-select-group-search"),s=t.find(".hierarchical-select-group-select");this._filterByText(i,s,e),this._selectGroupSelect(s)},_filterByText:function(e,i,s){e.on("input change keyup",function(){var e=t.trim(t(this).val()),s=new RegExp(e,"gi");i.find("option").each(function(e,i){null!==t(i).text().match(s)?t(i).removeClass("hidden").removeAttr("disabled"):t(i).addClass("hidden").attr("disabled","disabled")})})},_selectGroupSelect:function(e){var i=this;e.on("change",function(){var s=t(this),n=i._getSelectGroupKey(e),o=s.val();i._blockAllSelectGroups(),i._saveSelectSelection(n,o),i._removeFollowingSelectGroups(n),i._loadChildrenForSelection(s,o)}).on("keydown keypress keyup",function(e){if(-1!==t.inArray(e.which,[i.LEFT_ARROW_KEY_CODE,i.RIGHT_ARROW_KEY_CODE]))return e.preventDefault(),e.stopPropagation(),!1})},_createSelectOption:function(t,e,i,s,n){s=s?'selected="selected"':"",n=n||!1,t.append('<option value="'+e+'"'+s+' data-folder="'+n+'">'+i+"</option>")},_saveSelectSelection:function(t,e){this._selectedOptionsInSelectGroups[t]=e,this.$select.find("option").removeAttr("selected"),0==this.$select.find('option[value="'+e+'"]').length?this._createSelectOption(this.$select,e,"",!0,!1):this.$select.val(e)},_removeFollowingSelectGroups:function(t){for(this._cleanSelectedOptionsInSelectGroups(t);this._isNotLastSelectGroup(t);)this._removeLastSelectGroup()},_loadChildrenForSelection:function(e,i){var s=this;if(this._categoryHasChildren(e,i)){var n=this._getNoOfExistingGroups();this._categoryChildrenAreLoaded(i)?this._newSelectGroup(n,this.data[i]):t.get(this.ajaxRoute,{key:i},function(e){s.data[i]=[],t.each(e,function(t,e){s.data[i].push({key:e.key,title:e.title,folder:!!e.folder&&e.folder,selected:!!e.selected&&e.selected})}),s._newSelectGroup(n,s.data[i])},"json")}else this._unblockAllSelectGroups(e)},_updateWidths:function(){this._resetWidths(),this._calculateNewWidths(),this._setNewWidths(),this._setCurrentPosAfterResize(),this._setButtonsState(),this._animateAction("resize")},_resetWidths:function(){var e=this.$containerItems.find(".hierarchical-select-group");this.$containerItems.css({width:"",left:""}),t.each(e,function(e,i){t(this).css({width:""})})},_calculateNewWidths:function(){this.itemWidth=this.$firstSelectGroup.width()-1,this.itemOuterWidth=this.$firstSelectGroup.outerWidth()-1,this.currentMaxVisibleItems=Math.floor(this.$overflowContainer.width()/this.itemWidth)},_setNewWidths:function(){var e=this,i=e.$containerItems.find(".hierarchical-select-group");t.each(i,function(){t(this).width(e.itemWidth)}),e.$containerItems.width(e._getNoOfExistingGroups()*this.itemOuterWidth),e.visibleRemainingWidthOfItem=0,e.isScrolling=!1},_onScroll:function(){var t=this;t.isScrolling||(t.isScrolling=!0,t.$overflowContainer.off("mouseup"),t.$overflowContainer.on("mouseup",function(e){setTimeout(function(){t._onMouseUp()},t.MOUSE_UP_DELAY)}))},_animateAction:function(t){var e=Math.max(0,(this.currentPos-this.currentMaxVisibleItems)*this.itemOuterWidth);switch(t){case"append":this.$containerItems.parent().scrollLeft(e-this.itemOuterWidth),this.$containerItems.parent().stop().animate({scrollLeft:e},this.ANIMATE_TIME);break;case"removeLast":this.$containerItems.parent().scrollLeft(e);break;case"next":case"prev":this.$containerItems.parent().stop().animate({scrollLeft:e},this.ANIMATE_TIME);break;case"resize":this.$containerItems.parent().scrollLeft(e)}},_setCurrentPosAfterResize:function(){var t=this._getNoOfExistingGroups();t>=this.currentMaxVisibleItems?0!==this.visibleRemainingWidthOfItem?this.currentPos=Math.max(this.currentPos+1,this.currentMaxVisibleItems):this.currentPos=Math.max(this.currentPos,this.currentMaxVisibleItems):this.currentPos=t},_setButtonsState:function(){var t=this,e=t._getNoOfExistingGroups();setTimeout(function(){t.currentPos>=e?t.$btnNext.addClass("disabled"):t.$btnNext.removeClass("disabled"),e<=t.currentMaxVisibleItems||0==t.$containerItems.parent().scrollLeft()?t.$btnPrev.addClass("disabled"):t.$btnPrev.removeClass("disabled")},t.MOUSE_UP_DELAY)},_next:function(){if(0!==this.visibleRemainingWidthOfItem){var t=this.$containerItems.parent().scrollLeft()+this.visibleRemainingWidthOfItem;this.visibleRemainingWidthOfItem=0,this._setCurrentPosToNextFullyViewedItem(t)}else this.currentPos=Math.min(this._getNoOfExistingGroups(),this.currentPos+1);this._setButtonsState(),this._animateAction("next")},_setCurrentPosToNextFullyViewedItem:function(t){this.currentPos=Math.min(Math.floor(t/this.itemOuterWidth)+this.currentMaxVisibleItems,this._getNoOfExistingGroups())},_prev:function(){var t=this.$containerItems.parent().scrollLeft()-(this.itemOuterWidth-this.visibleRemainingWidthOfItem);this.visibleRemainingWidthOfItem=0,this._setCurrentPosToPreviousFullyViewedItem(t),this._setButtonsState(),this._animateAction("prev")},_setCurrentPosToPreviousFullyViewedItem:function(t){this.currentPos=Math.round(t/this.itemOuterWidth)+this.currentMaxVisibleItems},_onMouseUp:function(){var t=this._getNoOfExistingGroups();if(this.outsideLeftPosition=this.$containerItems.parent().scrollLeft(),this.visibleRemainingWidthOfItem=this.itemOuterWidth-this.outsideLeftPosition%this.itemOuterWidth,this.visibleRemainingWidthOfItem==this.itemOuterWidth&&(this.visibleRemainingWidthOfItem=0),this.outsideLeftPosition>0){var e=this._getNoOfItemsNotVisible();this.currentPos=Math.min(e+this.currentMaxVisibleItems,t)}else this.currentPos=this.currentMaxVisibleItems;this.isScrolling=!0,this._setButtonsState()},_getNoOfItemsNotVisible:function(){return Math.round(this.outsideLeftPosition/this.itemOuterWidth)},_isFirstSelectGroup:function(){return 1==this._getNoOfExistingGroups()},_getSelectGroupKey:function(t){return parseInt(t.attr("data-key"))},_isGroupKeyOption:function(t,e){return this._selectedOptionsInSelectGroups[t]==e},_hasDataStructure:function(t){return t instanceof Array&&t.length>0},_getNoOfExistingGroups:function(){return this.element.find(".hierarchical-select-group").length},_cleanSelectedOptionsInSelectGroups:function(t){this._selectedOptionsInSelectGroups.splice(t+1,this._selectedOptionsInSelectGroups.length)},_isNotLastSelectGroup:function(t){return this._getNoOfExistingGroups()>t+1},_removeLastSelectGroup:function(){this.$overflowContainer.off("mouseup"),this.element.find(".hierarchical-select-group:last").remove(),this.currentPos=this._getNoOfExistingGroups(),this._updateWidths(),this._animateAction("removeLast")},_categoryHasChildren:function(t,e){return"true"==t.find('option[value="'+e+'"]').attr("data-folder")},_categoryChildrenAreLoaded:function(t){return this.data[t]&&this._hasDataStructure(this.data[t])},_blockAllSelectGroups:function(){this.element.find("select").blur().css("overflow-y","hidden"),this.element.find("input, select").attr("disabled","disabled"),this.$overflowContainer.blockControl()},_unblockAllSelectGroups:function(t){if(this.element.find("select").css("overflow-y","scroll").blur(),this.element.find("input, select").removeAttr("disabled"),this.$overflowContainer.unblockControl(),t)t.focus();else{var e=this._getNoOfExistingGroups();this.element.find("select").eq(e-2).focus()}}},t.widget("ui.HierarchicalSelect",{options:{searchPlaceholder:"Search",select:"",data:null,displayedSelects:[0],ajaxRoute:""},_create:function(){this.HierarchicalSelect=new i(this)}})}}(jQuery,window);