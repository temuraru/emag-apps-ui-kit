/*!
 * eMAG Apps UI KIT v1.0.0 * Copyright 2001-2018 eMAG HX Team
 * Licensed under the ISC license
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";if(!e.ui||!e.ui.fancytree){var t,n,i=null,r=new RegExp(/\.|\//),o=/[&<>"'\/]/g,s=/[<>"'\/]/g,a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},l={16:!0,17:!0,18:!0},d={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},h={0:"",1:"left",2:"middle",3:"right"},u="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),f={},p="columns types".split(" "),g="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),y={},v={},m={active:!0,children:!0,data:!0,focus:!0};for(t=0;t<u.length;t++)f[u[t]]=!0;for(t=0;t<g.length;t++)n=g[t],y[n]=!0,n!==n.toLowerCase()&&(v[n.toLowerCase()]=n);return b(e.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),F.prototype={_findDirectChild:function(e){var t,n,i=this.children;if(i)if("string"==typeof e){for(t=0,n=i.length;t<n;t++)if(i[t].key===e)return i[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){b(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new F(this,e[t]))},addChildren:function(t,n){var i,r,o,s,a=this.getFirstChild(),l=this.getLastChild(),d=[];for(e.isPlainObject(t)&&(t=[t]),this.children||(this.children=[]),i=0,r=t.length;i<r;i++)d.push(new F(this,t[i]));if(s=d[0],null==n?this.children=this.children.concat(d):(n=this._findDirectChild(n),b((o=e.inArray(n,this.children))>=0,"insertBefore must be an existing child"),this.children.splice.apply(this.children,[o,0].concat(d))),a&&!n){for(i=0,r=d.length;i<r;i++)d[i].render();a!==this.getFirstChild()&&a.renderStatus(),l!==this.getLastChild()&&l.renderStatus()}else(!this.parent||this.parent.ul||this.tr)&&this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===d.length?d[0]:null),s},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(void 0!==t&&"over"!==t||(t="child"),t){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}b(!1,"Invalid mode: "+t)},addPagingNode:function(t,n){var i,r;if(n=n||"child",!1!==t)return t=e.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},t),this.partload=!0,this.addNode(t,n);for(i=this.children.length-1;i>=0;i--)"paging"===(r=this.children[i]).statusNodeType&&this.removeChild(r);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyPatch:function(t){if(null===t)return this.remove(),N(this);var n,i,r={children:!0,expanded:!0,parent:!0};for(n in t)i=t[n],r[n]||e.isFunction(i)||(y[n]?this[n]=i:this.data[n]=i);return t.hasOwnProperty("children")&&(this.removeChildren(),t.children&&this._setChildren(t.children)),this.isVisible()&&(this.renderTitle(),this.renderStatus()),t.hasOwnProperty("expanded")?this.setExpanded(t.expanded):N(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,i,r=this.children;if(!r)return 0;if(i=r.length,!1!==e)for(t=0,n=i;t<n;t++)i+=r[t].countChildren();return i},debug:function(e){this.tree.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),x("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){var t=e?"nodeRemoveMarkup":"nodeRemoveChildMarkup";this.tree._callHook(t,this)},error:function(e){this.options.debugLevel>=1&&(Array.prototype.unshift.call(arguments,this.toString()),x("error",arguments))},findAll:function(t){t=e.isFunction(t)?t:I(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=e.isFunction(t)?t:I(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},_changeSelectStatusAttrs:function(e){var t=!1,n=this.tree.options,r=i.evalOption("unselectable",this,this,n,!1),o=i.evalOption("unselectableStatus",this,this,n,void 0);switch(r&&null!=o&&(e=o),e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:b(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){e._changeSelectStatusAttrs(t)}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){var t=this.tree.options;b(3===t.selectMode,"expected selectMode 3"),function e(n){var r,o,s,a,l,d,c,h,u=n.children;if(u&&u.length){for(d=!0,c=!1,r=0,o=u.length;r<o;r++)a=e(s=u[r]),i.evalOption("unselectableIgnore",s,s,t,!1)||(!1!==a&&(c=!0),!0!==a&&(d=!1));l=!!d||!!c&&void 0}else l=null==(h=i.evalOption("unselectableStatus",n,n,t,void 0))?!!n.selected:!!h;return n._changeSelectStatusAttrs(l),l}(this),this.visitParents(function(e){var n,r,o,s,a,l=e.children,d=!0,c=!1;for(n=0,r=l.length;n<r;n++)o=l[n],i.evalOption("unselectableIgnore",o,o,t,!1)||(((s=null==(a=i.evalOption("unselectableStatus",o,o,t,void 0))?!!o.selected:!!a)||o.partsel)&&(c=!0),s||(d=!1));s=!!d||!!c&&void 0,e._changeSelectStatusAttrs(s)})},fromDict:function(t){for(var n in t)y[n]?this[n]=t[n]:"data"===n?e.extend(this.data,t.data):e.isFunction(t[n])||m[n]||(this.data[n]=t[n]);t.children&&(this.removeChildren(),this.addChildren(t.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return e.inArray(this,this.parent.children)},getIndexHier:function(t,n){t=t||".";var i,r=[];return e.each(this.getParentList(!1,!0),function(e,t){i=""+(t.getIndex()+1),n&&(i=("0000000"+i).substr(-n)),r.push(i)}),r.join(t)},getKeyPath:function(e){var t=[],n=this.tree.options.keyPathSeparator;return this.visitParents(function(e){e.parent&&t.unshift(e.key)},!e),n+t.join(n)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=0,t=n.length-1;e<t;e++)if(n[e]===this)return n[e+1]}return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],i=t?this:this.parent;i;)(e||i.parent)&&n.unshift(i),i=i.parent;return n},getPrevSibling:function(){if(this.parent){var e,t,n=this.parent.children;for(e=1,t=n.length;e<t;e++)if(n[e]===this)return n[e-1]}return null},getSelectedNodes:function(e){var t=[];return this.visit(function(n){if(n.selected&&(t.push(n),!0===e))return"skip"}),t},hasChildren:function(){if(this.lazy){if(null==this.children)return;if(0===this.children.length)return!1;if(1===this.children.length&&this.children[0].isStatusNode())return;return!0}return!(!this.children||!this.children.length)},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){this.tree.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),x("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(t){if(!t||t.tree!==this.tree)return!1;for(var n=this.parent;n;){if(n===t)return!0;n===n.parent&&e.error("Recursive parent link: "+n),n=n.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,n=this.getParentList(!1,!1);for(e=0,t=n.length;e<t;e++)if(!n[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t,n,i=this,r=this.isExpanded();return b(this.isLazy(),"load() requires a lazy node"),e||this.isUndefined()?(this.isLoaded()&&this.resetLazy(),!1===(n=this.tree._triggerNodeEvent("lazyLoad",this))?N(this):(b("boolean"!=typeof n,"lazyLoad event must return source in data.result"),t=this.tree._callHook("nodeLoadChildren",this,n),r?(this.expanded=!0,t.always(function(){i.render()})):t.always(function(){i.renderStatus()}),t)):N(this)},makeVisible:function(t){var n,i=this,r=[],o=new e.Deferred,s=this.getParentList(!1,!1),a=s.length,l=!(t&&!0===t.noAnimation),d=!(t&&!1===t.scrollIntoView);for(n=a-1;n>=0;n--)r.push(s[n].setExpanded(!0,t));return e.when.apply(e,r).done(function(){d?i.scrollIntoView(l).done(function(){o.resolve()}):o.resolve()}),o.promise()},moveTo:function(t,n,i){void 0===n||"over"===n?n="child":"firstChild"===n&&(t.children&&t.children.length?(n="before",t=t.children[0]):n="child");var r,o=this.parent,s="child"===n?t:t.parent;if(this!==t){if(this.parent?s.isDescendantOf(this)&&e.error("Cannot move a node to its own descendant"):e.error("Cannot move system root"),s!==o&&o.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===s)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else b((r=e.inArray(this,this.parent.children))>=0,"invalid source parent"),this.parent.children.splice(r,1);if(this.parent=s,s.hasChildren())switch(n){case"child":s.children.push(this);break;case"before":b((r=e.inArray(t,s.children))>=0,"invalid target parent"),s.children.splice(r,0,this);break;case"after":b((r=e.inArray(t,s.children))>=0,"invalid target parent"),s.children.splice(r+1,0,this);break;default:e.error("Invalid mode "+n)}else s.children=[this];i&&t.visit(i,!0),s===o?s.triggerModifyChild("move",this):s.triggerModifyChild("add",this),this.tree!==t.tree&&(this.warn("Cross-tree moveTo is experimantal!"),this.visit(function(e){e.tree=t.tree},!0)),o.isDescendantOf(s)||o.render(),s.isDescendantOf(o)||s===o||s.render()}},navigate:function(t,n){var i,r,o,s=e.ui.keyCode,a=null;function l(i){if(i){try{i.makeVisible({scrollIntoView:!1})}catch(e){}return e(i.span).is(":visible")?!1===n?i.setFocus():i.setActive():(i.debug("Navigate: skipping hidden node"),void i.navigate(t,n))}}switch(t){case s.BACKSPACE:this.parent&&this.parent.parent&&(o=l(this.parent));break;case s.HOME:this.tree.visit(function(t){if(e(t.span).is(":visible"))return o=l(t),!1});break;case s.END:this.tree.visit(function(t){e(t.span).is(":visible")&&(o=t)}),o&&(o=l(o));break;case s.LEFT:this.expanded?(this.setExpanded(!1),o=l(this)):this.parent&&this.parent.parent&&(o=l(this.parent));break;case s.RIGHT:this.expanded||!this.children&&!this.lazy?this.children&&this.children.length&&(o=l(this.children[0])):(this.setExpanded(),o=l(this));break;case s.UP:for(a=this.getPrevSibling();a&&!e(a.span).is(":visible");)a=a.getPrevSibling();for(;a&&a.expanded&&a.children&&a.children.length;)a=a.children[a.children.length-1];!a&&this.parent&&this.parent.parent&&(a=this.parent),o=l(a);break;case s.DOWN:if(this.expanded&&this.children&&this.children.length)a=this.children[0];else for(i=(r=this.getParentList(!1,!0)).length-1;i>=0;i--){for(a=r[i].getNextSibling();a&&!e(a.span).is(":visible");)a=a.getNextSibling();if(a)break}o=l(a);break;default:!1}return o||N()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(n){var i,r=this.parent,o=e.inArray(this,r.children),s=this;return b(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(i=this.tree._callHook("nodeLoadChildren",this,n)).done(function(e){var n=s.children;for(t=0;t<n.length;t++)n[t].parent=r;r.children.splice.apply(r.children,[o+1,0].concat(n)),s.children=null,s.remove(),r.render()}).fail(function(){s.setExpanded()}),i},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(t,n){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var i=this;switch(t){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger expand"),i.setExpanded(!0)},n);break;case"activate":this.tree.timer=setTimeout(function(){i.tree.debug("setTimeout: trigger activate"),i.setActive(!0)},n);break;default:e.error("Invalid mode "+t)}},scrollIntoView:function(t,n){if(void 0!==n&&((i=n).tree&&void 0!==i.statusNodeType))throw"scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.";var i,r=e.extend({effects:!0===t?{duration:200,queue:!1}:t,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},n),o=r.scrollParent;o?o.jquery||(o=e(o)):o=this.tree.tbody?this.tree.$container.scrollParent():this.tree.$container,o[0]!==document&&o[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",o[0]),o=e(window));var s,a,l,d=new e.Deferred,c=this,h=e(this.span).height(),u=r.scrollOfs.top||0,f=r.scrollOfs.bottom||0,p=o.height(),g=o.scrollTop(),y=o,v=o[0]===window,m=r.topNode||null,x=null;return e(this.span).is(":visible")?(v?(a=e(this.span).offset().top,s=m&&m.span?e(m.span).offset().top:0,y=e("html,body")):(b(o[0]!==document&&o[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),l=o.offset().top,a=e(this.span).offset().top-l+g,s=m?e(m.span).offset().top-l+g:0,p-=Math.max(0,o.innerHeight()-o[0].clientHeight)),a<g+u?x=a-u:a+h>g+p-f&&(x=a+h-p+f,m&&(b(m.isRootNode()||e(m.span).is(":visible"),"topNode must be visible"),s<x&&(x=s-u))),null!==x?r.effects?(r.effects.complete=function(){d.resolveWith(c)},y.stop(!0).animate({scrollTop:x},r.effects)):(y[0].scrollTop=x,d.resolveWith(this)):d.resolveWith(this),d.promise()):(this.warn("scrollIntoView(): node is invisible."),N())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,i,r=this.children;if(r){if(e=e||function(e,t){var n=e.title.toLowerCase(),i=t.title.toLowerCase();return n===i?0:n>i?1:-1},r.sort(e),t)for(n=0,i=r.length;n<i;n++)r[n].children&&r[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(t,n){var i,r,o,s={},a=this;if(e.each(g,function(e,t){(a[t]||!1===a[t])&&(s[t]=a[t])}),e.isEmptyObject(this.data)||(s.data=e.extend({},this.data),e.isEmptyObject(s.data)&&delete s.data),n&&n(s,a),t&&this.hasChildren())for(s.children=[],i=0,r=this.children.length;i<r;i++)(o=this.children[i]).isStatusNode()||s.children.push(o.toDict(!0,n));return s},toggleClass:function(t,n){var i,r,o=t.match(/\S+/g)||[],s=0,a=!1,l=this[this.tree.statusClassPropName],d=" "+(this.extraClasses||"")+" ";for(l&&e(l).toggleClass(t,n);i=o[s++];)if(r=d.indexOf(" "+i+" ")>=0,n=void 0===n?!r:!!n)r||(d+=i+" ",a=!0);else for(;d.indexOf(" "+i+" ")>-1;)d=d.replace(" "+i+" "," ");return this.extraClasses=e.trim(d),a},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(t,n,i){var r,o=this.tree.options.modifyChild;o&&(n&&n.parent!==this&&e.error("childNode "+n+" is not a child of "+this),r={node:this,tree:this.tree,operation:t,childNode:n||null},i&&e.extend(r,i),o({type:"modifyChild"},r))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,i,r=!0,o=this.children;if(!0===t&&(!1===(r=e(this))||"skip"===r))return r;if(o)for(n=0,i=o.length;n<i&&!1!==(r=o[n].visit(e,!0));n++);return r},visitAndLoad:function(t,n,i){var r,o,s,a=this;return!t||!0!==n||!1!==(o=t(a))&&"skip"!==o?a.children||a.lazy?(r=new e.Deferred,s=[],a.load().done(function(){for(var n=0,i=a.children.length;n<i;n++){if(!1===(o=a.children[n].visitAndLoad(t,!0,!0))){r.reject();break}"skip"!==o&&s.push(o)}e.when.apply(this,s).then(function(){r.resolve()})}),r.promise()):N():i?o:N()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},visitSiblings:function(e,t){var n,i,r,o=this.parent.children;for(n=0,i=o.length;n<i;n++)if(r=o[n],(t||r!==this)&&!1===e(r))return!1;return!0},warn:function(e){this.tree.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),x("warn",arguments))}},A.prototype={_makeHookContext:function(t,n,i){var r,o;return void 0!==t.node?(n&&t.originalEvent!==n&&e.error("invalid args"),r=t):t.tree?r={node:t,tree:o=t.tree,widget:o.widget,options:o.widget.options,originalEvent:n,typeInfo:o.types[t.type]||{}}:t.widget?r={node:null,tree:t,widget:t.widget,options:t.widget.options,originalEvent:n}:e.error("invalid args"),i&&e.extend(r,i),r},_callHook:function(t,n,i){var r=this._makeHookContext(n),o=this[t],s=Array.prototype.slice.call(arguments,2);return e.isFunction(o)||e.error("_callHook('"+t+"') is not a function"),s.unshift(r),o.apply(this,s)},_setExpiringValue:function(e,t,n){this._tempCache[e]={value:t,expire:Date.now()+(+n||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_requireExtension:function(t,n,i,r){null!=i&&(i=!!i);var o=this._local.name,s=this.options.extensions,a=e.inArray(t,s)<e.inArray(o,s),l=n&&null==this.ext[t],d=!l&&null!=i&&i!==a;return b(o&&o!==t,"invalid or same name"),!l&&!d||(r||(l||n?(r="'"+o+"' extension requires '"+t+"'",d&&(r+=" to be registered "+(i?"before":"after")+" itself")):r="If used together, `"+t+"` must be registered "+(i?"before":"after")+" `"+o+"`"),e.error(r),!1)},activateKey:function(e,t){var n=this.getNodeByKey(e);return n?n.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),n},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyPatch:function(t){var n,i,r,o,s,a,l=t.length,d=[];for(i=0;i<l;i++)b(2===(r=t[i]).length,"patchList must be an array of length-2-arrays"),o=r[0],s=r[1],(a=null===o?this.rootNode:this.getNodeByKey(o))?(n=new e.Deferred,d.push(n),a.applyPatch(s).always(w(n,a))):this.warn("could not find node with key '"+o+"'");return e.when.apply(e,d).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){this.options.debugLevel>=4&&(Array.prototype.unshift.call(arguments,this.toString()),x("log",arguments))},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return e=!1!==e,!!this._enableUpdate==!!e?e:(this._enableUpdate=e,e?(this.debug("enableUpdate(true): redraw "),this.render()):this.debug("enableUpdate(false)..."),!e)},expandAll:function(e,t){e=!1!==e,this.visit(function(n){!1!==n.hasChildren()&&n.isExpanded()!==e&&n.setExpanded(e,t)})},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n,i){var r;t="string"==typeof t?(r=new RegExp("^"+t,"i"),function(e){return r.test(e.title)}):t,n=n||this.getFirstChild();var o=null,s=n.parent.children,a=null,l=function(e,t,n){var i,r,o=e.children,s=o.length,a=o[t];if(a&&!1===n(a))return!1;if(a&&a.children&&a.expanded&&!1===l(a,0,n))return!1;for(i=t+1;i<s;i++)if(!1===l(e,i,n))return!1;return(r=e.parent)?l(r,r.children.indexOf(e)+1,n):l(e,0,n)};return l(n.parent,s.indexOf(n),function(i){return i!==o&&(o=o||i,e(i.span).is(":visible")?(!t(i)||(a=i)===n)&&void 0:void i.debug("quicksearch: skipping hidden node"))}),a},generateFormElements:function(t,n,i){i=i||{};var r,o="string"==typeof t?t:"ft_"+this._id+"[]",s="string"==typeof n?n:"ft_"+this._id+"_active",a="fancytree_result_"+this._id,l=e("#"+a),d=3===this.options.selectMode&&!1!==i.stopOnParents;function c(t){l.append(e("<input>",{type:"checkbox",name:o,value:t.key,checked:!0}))}l.length?l.empty():l=e("<div>",{id:a}).hide().insertAfter(this.$container),!1!==n&&this.activeNode&&l.append(e("<input>",{type:"radio",name:s,value:this.activeNode.key,checked:!0})),i.filter?this.visit(function(e){var t=i.filter(e);if("skip"===t)return t;!1!==t&&c(e)}):!1!==t&&(r=this.getSelectedNodes(d),e.each(r,function(e,t){c(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(e,t){var n,i;return!t&&(n=document.getElementById(this.options.idPrefix+e))?n.ftnode?n.ftnode:null:(t=t||this.rootNode,i=null,t.visit(function(t){if(t.key===e)return i=t,!1},!0),i)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){this.options.debugLevel>=3&&(Array.prototype.unshift.call(arguments,this.toString()),x("info",arguments))},loadKeyPath:function(t,n){var i,r,o,s=this,a=new e.Deferred,l=this.getRootNode(),d=this.options.keyPathSeparator,c=[],h=e.extend({},n);for("function"==typeof n?i=n:n&&n.callback&&(i=n.callback),h.callback=function(e,t,n){i&&i.call(e,t,n),a.notifyWith(e,[{node:t,status:n}])},null==h.matchKey&&(h.matchKey=function(e,t){return e.key===t}),e.isArray(t)||(t=[t]),r=0;r<t.length;r++)(o=t[r]).charAt(0)===d&&(o=o.substr(1)),c.push(o.split(d));return setTimeout(function(){s._loadKeyPathImpl(a,h,l,c).done(function(){a.resolve()})},0),a.promise()},_loadKeyPathImpl:function(t,n,i,r){var o,s,a,l,d,c,h,u,f=this;function p(e,t){var i,r,o=e.children;if(o)for(i=0,r=o.length;i<r;i++)if(n.matchKey(o[i],t))return o[i];return null}for(d={},s=0;s<r.length;s++)for(h=r[s],c=i;h.length;){if(a=h.shift(),!(l=p(c,a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+c+")"),n.callback(this,a,"error");break}if(0===h.length){n.callback(this,l,"ok");break}if(l.lazy&&void 0===l.hasChildren()){n.callback(this,l,"loaded"),d[a=l.key]?d[a].pathSegList.push(h):d[a]={parent:l,pathSegList:[h]};break}n.callback(this,l,"loaded"),c=l}function g(e,t,i){n.callback(f,t,"loading"),t.load().done(function(){f._loadKeyPathImpl.call(f,e,n,t,i).always(w(e,f))}).fail(function(i){f.warn("loadKeyPath: error loading lazy "+t),n.callback(f,l,"error"),e.rejectWith(f)})}for(var y in o=[],d){var v=d[y];u=new e.Deferred,o.push(u),g(u,v.parent,v.pathSegList)}return e.when.apply(e,o).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):N()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(e){this.visit(function(t){t.setSelected(e)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},toDict:function(e,t){var n=this.rootNode.toDict(!0,t);return e?n:n.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,n,i){var r=this._makeHookContext(t,n,i),o=this.widget._trigger(e,n,r);return!1!==o&&void 0!==r.result?r.result:o},_triggerTreeEvent:function(e,t,n){var i=this._makeHookContext(this,t,n),r=this.widget._trigger(e,t,i);return!1!==r&&void 0!==i.result?i.result:r},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(e,t){if(t&&t.reverse)return delete t.reverse,this._visitRowsUp(e,t);var n,i,r,o=0,s=!1===t.includeSelf,a=!!t.includeHidden,l=t.start||this.rootNode.children[0];for(i=l.parent;i;){for(n=(r=i.children).indexOf(l)+o;n<r.length;n++){if(l=r[n],!s&&!1===e(l))return!1;if(s=!1,l.children&&l.children.length&&(a||l.expanded)&&!1===l.visit(function(t){return!1!==e(t)&&(a||!t.children||t.expanded?void 0:"skip")},!1))return!1}l=i,i=i.parent,o=1}return!0},_visitRowsUp:function(t,n){for(var i,r,o,s=!!n.includeHidden,a=n.start||this.rootNode.children[0];;){if((i=(o=a.parent).children)[0]===a)a=o,i=o.children;else for(r=i.indexOf(a),a=i[r-1];(s||a.expanded)&&a.children&&a.children.length;)o=a,a=(i=a.children)[i.length-1];if((s||e(a.span).is(":visible"))&&!1===t(a))return!1}},warn:function(e){this.options.debugLevel>=2&&(Array.prototype.unshift.call(arguments,this.toString()),x("warn",arguments))}},e.extend(A.prototype,{nodeClick:function(e){var t,n,i=e.targetType,r=e.node;if("expander"===i){if(r.isLoading())return void r.debug("Got 2nd click while loading: ignored");this._callHook("nodeToggleExpanded",e)}else if("checkbox"===i)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(n=!1,t=!0,r.folder)switch(e.options.clickFolderMode){case 2:n=!0,t=!1;break;case 3:t=!0,n=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,i,r,o=e.node;if(o.parent)for(i=0,r=(n=o.parent.children).length;i<r;i++)n[i]!==o&&n[i].expanded&&this._callHook("nodeSetExpanded",n[i],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(t){var n,r,o,s=t.originalEvent,a=t.node,l=t.tree,h=t.options,u=s.which,f=s.key||String.fromCharCode(u),p=!c[u]&&!d[u],g=e(s.target),y=!0,v=!(s.ctrlKey||!h.autoActivate);if(a||(o=this.getActiveNode()||this.getFirstChild())&&(o.setFocus(),(a=t.node=this.focusNode).debug("Keydown force focus on active node")),h.quicksearch&&p&&!g.is(":input:enabled"))return(r=Date.now())-l.lastQuicksearchTime>500&&(l.lastQuicksearchTerm=""),l.lastQuicksearchTime=r,l.lastQuicksearchTerm+=f,(n=l.findNextNode(l.lastQuicksearchTerm,l.getActiveNode()))&&n.setActive(),void s.preventDefault();switch(i.eventToString(s)){case"+":case"=":l.nodeSetExpanded(t,!0);break;case"-":l.nodeSetExpanded(t,!1);break;case"space":a.isPagingNode()?l._triggerNodeEvent("clickPaging",t,s):i.evalOption("checkbox",a,a,h,!1)?l.nodeToggleSelected(t):l.nodeSetActive(t,!0);break;case"return":l.nodeSetActive(t,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":a.navigate(s.which,v);break;default:y=!1}y&&s.preventDefault()},nodeLoadChildren:function(t,n){var i,r,o,s=t.tree,a=t.node,l=Date.now();if(e.isFunction(n)&&(n=n.call(s,{type:"source"},t),b(!e.isFunction(n),"source callback must not return another function")),n.url&&(a._requestId&&a.warn("Recursive load request #"+l+" while #"+a._requestId+" is pending."),i=e.extend({},t.options.ajax,n),a._requestId=l,i.debugDelay?(r=i.debugDelay,delete i.debugDelay,e.isArray(r)&&(r=r[0]+Math.random()*(r[1]-r[0])),a.warn("nodeLoadChildren waiting debugDelay "+Math.round(r)+" ms ..."),o=e.Deferred(function(t){setTimeout(function(){e.ajax(i).done(function(){t.resolveWith(this,arguments)}).fail(function(){t.rejectWith(this,arguments)})},r)})):o=e.ajax(i),n=new e.Deferred,o.done(function(i,r,o){var d,c;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof i||e.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),a._requestId&&a._requestId>l)n.rejectWith(this,["$recursive_request"]);else{if(t.options.postProcess){try{c=s._triggerNodeEvent("postProcess",t,t.originalEvent,{response:i,error:null,dataType:this.dataType})}catch(e){c={error:e,message:""+e,details:"postProcess failed"}}if(c.error)return d=e.isPlainObject(c.error)?c.error:{message:c.error},d=s._makeHookContext(a,null,d),void n.rejectWith(this,[d]);(e.isArray(c)||e.isPlainObject(c)&&e.isArray(c.children))&&(i=c)}else i&&i.hasOwnProperty("d")&&t.options.enableAspx&&(i="string"==typeof i.d?e.parseJSON(i.d):i.d);n.resolveWith(this,[i])}}).fail(function(e,t,i){var r=s._makeHookContext(a,null,{error:e,args:Array.prototype.slice.call(arguments),message:i,details:e.status+": "+i});n.rejectWith(this,[r])})),e.isFunction(n.then)&&e.isFunction(n.catch)&&(o=n,n=new e.Deferred,o.then(function(e){n.resolve(e)},function(e){n.reject(e)})),e.isFunction(n.promise))s.nodeSetStatus(t,"loading"),n.done(function(e){s.nodeSetStatus(t,"ok"),a._requestId=null}).fail(function(e){var n;"$recursive_request"!==e?(e.node&&e.error&&e.message?n=e:"[object Object]"===(n=s._makeHookContext(a,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(n.message=""),a.warn("Load children failed ("+n.message+")",n),!1!==s._triggerNodeEvent("loadError",n,null)&&s.nodeSetStatus(t,"error",n.message,n.details)):a.warn("Ignored response for obsolete load request #"+l+" (expected #"+a._requestId+")")});else if(t.options.postProcess){var d=s._triggerNodeEvent("postProcess",t,t.originalEvent,{response:n,error:null,dataType:typeof n});(e.isArray(d)||e.isPlainObject(d)&&e.isArray(d.children))&&(n=d)}return e.when(n).done(function(n){var i,r;e.isPlainObject(n)&&(b(a.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),b(e.isArray(n.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),i=n,n=n.children,delete i.children,e.each(p,function(e,t){void 0!==i[t]&&(s[t]=i[t],delete i[t])}),e.extend(s.data,i)),b(e.isArray(n),"expected array of children"),a._setChildren(n),s.options.nodata&&0===n.length&&(e.isFunction(s.options.nodata)?r=s.options.nodata.call(s,{type:"nodata"},t):!0===s.options.nodata&&a.isRootNode()?r=s.options.strings.nodata:"string"==typeof s.options.nodata&&a.isRootNode()&&(r=s.options.nodata),r&&a.setStatus("nodata",r)),s._triggerNodeEvent("loadChildren",a)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(t,n){var i,r=t.node,o=e.extend({},t,{node:n}),s=r.children;if(1===s.length)return b(n===s[0],"invalid single child"),this.nodeRemoveChildren(t);this.activeNode&&(n===this.activeNode||this.activeNode.isDescendantOf(n))&&this.activeNode.setActive(!1),this.focusNode&&(n===this.focusNode||this.focusNode.isDescendantOf(n))&&(this.focusNode=null),this.nodeRemoveMarkup(o),this.nodeRemoveChildren(o),b((i=e.inArray(n,s))>=0,"invalid child"),r.triggerModifyChild("remove",n),n.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,n),s.splice(i,1)},nodeRemoveChildMarkup:function(t){var n=t.node;n.ul&&(n.isRootNode()?e(n.ul).empty():(e(n.ul).remove(),n.ul=null),n.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(t){var n=t.tree,i=t.node;i.children&&(this.activeNode&&this.activeNode.isDescendantOf(i)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(i)&&(this.focusNode=null),this.nodeRemoveChildMarkup(t),e.extend({},t),i.triggerModifyChild("remove",null),i.visit(function(e){e.parent=null,n._callHook("treeRegisterNode",n,!1,e)}),i.lazy?i.children=[]:i.children=null,i.isRootNode()||(i.expanded=!1),this.nodeRenderStatus(t))},nodeRemoveMarkup:function(t){var n=t.node;n.li&&(e(n.li).remove(),n.li=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,n,i,r,o){var s,a,l,d,c,h,u,f=t.node,p=t.tree,g=t.options,y=g.aria,v=!1,m=f.parent,x=!m,_=f.children,k=null;if(!1!==p._enableUpdate&&(x||m.ul)){if(b(x||m.ul,"parent UL must exist"),x||(f.li&&(n||f.li.parentNode!==f.parent.ul)&&(f.li.parentNode===f.parent.ul?k=f.li.nextSibling:this.debug("Unlinking "+f+" (must be child of "+f.parent+")"),this.nodeRemoveMarkup(t)),f.li?this.nodeRenderStatus(t):(v=!0,f.li=document.createElement("li"),f.li.ftnode=f,f.key&&g.generateIds&&(f.li.id=g.idPrefix+f.key),f.span=document.createElement("span"),f.span.className="fancytree-node",y&&!f.tr&&e(f.li).attr("role","treeitem"),f.li.appendChild(f.span),this.nodeRenderTitle(t),g.createNode&&g.createNode.call(p,{type:"createNode"},t)),g.renderNode&&g.renderNode.call(p,{type:"renderNode"},t)),_){if(x||f.expanded||!0===i){for(f.ul||(f.ul=document.createElement("ul"),(!0!==r||o)&&f.expanded||(f.ul.style.display="none"),y&&e(f.ul).attr("role","group"),f.li?f.li.appendChild(f.ul):f.tree.$div.append(f.ul)),d=0,c=_.length;d<c;d++)u=e.extend({},t,{node:_[d]}),this.nodeRender(u,n,i,!1,!0);for(s=f.ul.firstChild;s;)(l=s.ftnode)&&l.parent!==f?(f.debug("_fixParent: remove missing "+l,s),h=s.nextSibling,s.parentNode.removeChild(s),s=h):s=s.nextSibling;for(s=f.ul.firstChild,d=0,c=_.length-1;d<c;d++)(a=_[d])!==(l=s.ftnode)?f.ul.insertBefore(a.li,l.li):s=s.nextSibling}}else f.ul&&(this.warn("remove child markup for "+f),this.nodeRemoveChildMarkup(t));x||v&&m.ul.insertBefore(f.li,k)}},nodeRenderTitle:function(t,n){var o,s,a,l,d,c,h,u=t.node,f=t.tree,p=t.options,g=p.aria,y=u.getLevel(),v=[];void 0!==n&&(u.title=n),u.span&&!1!==f._enableUpdate&&(d=g&&!1!==u.hasChildren()?" role='button'":"",y<p.minExpandLevel?(u.lazy||(u.expanded=!0),y>1&&v.push("<span "+d+" class='fancytree-expander fancytree-expander-fixed'></span>")):v.push("<span "+d+" class='fancytree-expander'></span>"),(o=i.evalOption("checkbox",u,u,p,!1))&&!u.isStatusNode()&&(d=g?" role='checkbox'":"",s="fancytree-checkbox",("radio"===o||u.parent&&u.parent.radiogroup)&&(s+=" fancytree-radio"),v.push("<span "+d+" class='"+s+"'></span>")),void 0!==u.data.iconClass&&(u.icon?e.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(u.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),u.icon=u.data.iconClass)),!1!==(a=i.evalOption("icon",u,u,p,!0))&&(d=g?" role='presentation'":"",h=(h=i.evalOption("iconTooltip",u,u,p,null))?" title='"+E(h)+"'":"","string"==typeof a?r.test(a)?(a="/"===a.charAt(0)?a:(p.imagePath||"")+a,v.push("<img src='"+a+"' class='fancytree-icon'"+h+" alt='' />")):v.push("<span "+d+" class='fancytree-custom-icon "+a+"'"+h+"></span>"):a.text?v.push("<span "+d+" class='fancytree-custom-icon "+(a.addClass||"")+"'"+h+">"+i.escapeHtml(a.text)+"</span>"):a.html?v.push("<span "+d+" class='fancytree-custom-icon "+(a.addClass||"")+"'"+h+">"+a.html+"</span>"):v.push("<span "+d+" class='fancytree-icon'"+h+"></span>")),l="",p.renderTitle&&(l=p.renderTitle.call(f,{type:"renderTitle"},t)||""),l||(!0===(c=i.evalOption("tooltip",u,u,p,null))&&(c=u.title),l="<span class='fancytree-title'"+(c=c?" title='"+E(c)+"'":"")+(p.titlesTabbable?" tabindex='0'":"")+">"+(p.escapeTitles?i.escapeHtml(u.title):u.title)+"</span>"),v.push(l),u.span.innerHTML=v.join(""),this.nodeRenderStatus(t),p.enhanceTitle&&(t.$title=e(">span.fancytree-title",u.span),l=p.enhanceTitle.call(f,{type:"enhanceTitle"},t)||""))},nodeRenderStatus:function(t){var n,r=t.node,o=t.tree,s=t.options,a=r.hasChildren(),l=r.isLastSibling(),d=s.aria,c=s._classNames,h=[],u=r[o.statusClassPropName];u&&!1!==o._enableUpdate&&(d&&(n=e(r.tr||r.li)),h.push(c.node),o.activeNode===r&&h.push(c.active),o.focusNode===r&&h.push(c.focused),r.expanded&&h.push(c.expanded),d&&(!1!==a?n.attr("aria-expanded",Boolean(r.expanded)):n.removeAttr("aria-expanded")),r.folder&&h.push(c.folder),!1!==a&&h.push(c.hasChildren),l&&h.push(c.lastsib),r.lazy&&null==r.children&&h.push(c.lazy),r.partload&&h.push(c.partload),r.partsel&&h.push(c.partsel),i.evalOption("unselectable",r,r,s,!1)&&h.push(c.unselectable),r._isLoading&&h.push(c.loading),r._error&&h.push(c.error),r.statusNodeType&&h.push(c.statusNodePrefix+r.statusNodeType),r.selected?(h.push(c.selected),d&&n.attr("aria-selected",!0)):d&&n.attr("aria-selected",!1),r.extraClasses&&h.push(r.extraClasses),!1===a?h.push(c.combinedExpanderPrefix+"n"+(l?"l":"")):h.push(c.combinedExpanderPrefix+(r.expanded?"e":"c")+(r.lazy&&null==r.children?"d":"")+(l?"l":"")),h.push(c.combinedIconPrefix+(r.expanded?"e":"c")+(r.folder?"f":"")),u.className=h.join(" "),r.li&&e(r.li).toggleClass(c.lastsib,l))},nodeSetActive:function(t,n,i){i=i||{};var r,o=t.node,s=t.tree,a=t.options,l=!0===i.noEvents,d=!0===i.noFocus,c=!1!==i.scrollIntoView;return o===s.activeNode===(n=!1!==n)?N(o):n&&!l&&!1===this._triggerNodeEvent("beforeActivate",o,t.originalEvent)?S(o,["rejected"]):(n?(s.activeNode&&(b(s.activeNode!==o,"node was active (inconsistency)"),r=e.extend({},t,{node:s.activeNode}),s.nodeSetActive(r,!1),b(null===s.activeNode,"deactivate was out of sync?")),a.activeVisible&&o.makeVisible({scrollIntoView:c}),s.activeNode=o,s.nodeRenderStatus(t),d||s.nodeSetFocus(t),l||s._triggerNodeEvent("activate",o,t.originalEvent)):(b(s.activeNode===o,"node was not active (inconsistency)"),s.activeNode=null,this.nodeRenderStatus(t),l||t.tree._triggerNodeEvent("deactivate",o,t.originalEvent)),N(o))},nodeSetExpanded:function(t,n,i){i=i||{};var r,o,s,a,l,d,c=t.node,h=t.tree,u=t.options,f=!0===i.noAnimation,p=!0===i.noEvents;if(n=!1!==n,c.expanded&&n||!c.expanded&&!n)return N(c);if(n&&!c.lazy&&!c.hasChildren())return N(c);if(!n&&c.getLevel()<u.minExpandLevel)return S(c,["locked"]);if(!p&&!1===this._triggerNodeEvent("beforeExpand",c,t.originalEvent))return S(c,["rejected"]);if(f||c.isVisible()||(f=i.noAnimation=!0),o=new e.Deferred,n&&!c.expanded&&u.autoCollapse){l=c.getParentList(!1,!0),d=u.autoCollapse;try{for(u.autoCollapse=!1,s=0,a=l.length;s<a;s++)this._callHook("nodeCollapseSiblings",l[s],i)}finally{u.autoCollapse=d}}return o.done(function(){var e=c.getLastChild();n&&u.autoScroll&&!f&&e?e.scrollIntoView(!0,{topNode:c}).always(function(){p||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}):p||t.tree._triggerNodeEvent(n?"expand":"collapse",t)}),r=function(i){var r=u._classNames,o=u.toggleEffect;if(c.expanded=n,h._callHook("nodeRender",t,!1,!1,!0),c.ul)if("none"!==c.ul.style.display===!!c.expanded)c.warn("nodeSetExpanded: UL.style.display already set");else{if(o&&!f)return e(c.li).addClass(r.animating),void(e.isFunction(e(c.ul)[o.effect])?(h.debug("use jquery."+o.effect+" method"),e(c.ul)[o.effect]({duration:o.duration,always:function(){e(this).removeClass(r.animating),e(c.li).removeClass(r.animating),i()}})):(e(c.ul).stop(!0,!0),e(c.ul).parent().find(".ui-effects-placeholder").remove(),e(c.ul).toggle(o.effect,o.options,o.duration,function(){e(this).removeClass(r.animating),e(c.li).removeClass(r.animating),i()})));c.ul.style.display=c.expanded||!parent?"":"none"}i()},n&&c.lazy&&void 0===c.hasChildren()?c.load().done(function(){o.notifyWith&&o.notifyWith(c,["loaded"]),r(function(){o.resolveWith(c)})}).fail(function(e){r(function(){o.rejectWith(c,["load failed ("+e+")"])})}):r(function(){o.resolveWith(c)}),o.promise()},nodeSetFocus:function(t,n){var i,r=t.tree,o=t.node,s=r.options,a=!!t.originalEvent&&e(t.originalEvent.target).is(":input");if(n=!1!==n,r.focusNode){if(r.focusNode===o&&n)return;i=e.extend({},t,{node:r.focusNode}),r.focusNode=null,this._triggerNodeEvent("blur",i),this._callHook("nodeRenderStatus",i)}n&&(this.hasFocus()||(o.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",t,!0,{calledByNode:!0})),o.makeVisible({scrollIntoView:!1}),r.focusNode=o,s.titlesTabbable?a||e(o.span).find(".fancytree-title").focus():0===e(document.activeElement).closest(".fancytree-container").length&&e(r.$container).focus(),s.aria&&e(r.$container).attr("aria-activedescendant",e(o.tr||o.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",t),s.autoScroll&&o.scrollIntoView(),this._callHook("nodeRenderStatus",t))},nodeSetSelected:function(e,t,n){n=n||{};var r=e.node,o=e.tree,s=e.options,a=!0===n.noEvents,l=r.parent;if(t=!1!==t,!i.evalOption("unselectable",r,r,s,!1)){if(r._lastSelectIntent=t,!!r.selected===t&&(3!==s.selectMode||!r.partsel||t))return t;if(!a&&!1===this._triggerNodeEvent("beforeSelect",r,e.originalEvent))return!!r.selected;t&&1===s.selectMode?(o.lastSelectedNode&&o.lastSelectedNode.setSelected(!1),r.selected=t):3!==s.selectMode||!l||l.radiogroup||r.radiogroup?l&&l.radiogroup?r.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===r)},!0):r.selected=t:(r.selected=t,r.fixSelection3AfterClick(n)),this.nodeRenderStatus(e),o.lastSelectedNode=t?r:null,a||o._triggerNodeEvent("select",e)}},nodeSetStatus:function(t,n,i,r){var o=t.node,s=t.tree;function a(t,n){var i=o.children?o.children[0]:null;return i&&i.isStatusNode()?(e.extend(i,t),i.statusNodeType=n,s._callHook("nodeRenderTitle",i)):(o._setChildren([t]),o.children[0].statusNodeType=n,s.render()),o.children[0]}switch(n){case"ok":!function(){var e=o.children?o.children[0]:null;if(e&&e.isStatusNode()){try{o.ul&&(o.ul.removeChild(e.li),e.li=null)}catch(e){}1===o.children.length?o.children=[]:o.children.shift()}}(),o._isLoading=!1,o._error=null,o.renderStatus();break;case"loading":o.parent||a({title:s.options.strings.loading+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),o._isLoading=!0,o._error=null,o.renderStatus();break;case"error":a({title:s.options.strings.loadError+(i?" ("+i+")":""),checkbox:!1,tooltip:r},n),o._isLoading=!1,o._error={message:i,details:r},o.renderStatus();break;case"nodata":a({title:i||s.options.strings.noData,checkbox:!1,tooltip:r},n),o._isLoading=!1,o._error=null,o.renderStatus();break;default:e.error("invalid node status "+n)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,n=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(n=!1,t.selected=!0),t._lastSelectIntent=n,this.nodeSetSelected(e,n)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(t){var n=t.tree,i=n.options;n.$container.attr("tabindex",i.tabindex),e.each(p,function(e,t){void 0!==i[t]&&(n.info("Move option "+t+" to tree"),n[t]=i[t],delete i[t])}),i.rtl?n.$container.attr("DIR","RTL").addClass("fancytree-rtl"):n.$container.removeAttr("DIR").removeClass("fancytree-rtl"),i.aria&&(n.$container.attr("role","tree"),1!==i.selectMode&&n.$container.attr("aria-multiselectable",!0)),this.treeLoad(t)},treeLoad:function(t,n){var i,r,o,s=t.tree,a=t.widget.element,l=e.extend({},t,{node:this.rootNode});if(s.rootNode.children&&this.treeClear(t),n=n||this.options.source)"string"==typeof n&&e.error("Not implemented");else switch(r=a.data("type")||"html"){case"html":(o=a.find(">ul:first")).addClass("ui-fancytree-source fancytree-helper-hidden"),n=e.ui.fancytree.parseHtml(o),this.data=e.extend(this.data,T(o));break;case"json":n=e.parseJSON(a.text()),a.contents().filter(function(){return 3===this.nodeType}).remove(),e.isPlainObject(n)&&(b(e.isArray(n.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),i=n,n=n.children,delete i.children,e.each(p,function(e,t){void 0!==i[t]&&(s[t]=i[t],delete i[t])}),e.extend(s.data,i));break;default:e.error("Invalid data-type: "+r)}return this.nodeLoadChildren(l,n).done(function(){s.render(),3===t.options.selectMode&&s.rootNode.fixSelection3FromEndNodes(),s.activeNode&&s.options.activeVisible&&s.activeNode.makeVisible(),s._triggerTreeEvent("init",null,{status:!0})}).fail(function(){s.render(),s._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){},treeSetFocus:function(t,n,i){var r;(n=!1!==n)!==this.hasFocus()&&(this._hasFocus=n,!n&&this.focusNode?this.focusNode.setFocus(!1):!n||i&&i.calledByNode||e(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",n),this._triggerTreeEvent(n?"focusTree":"blurTree"),n&&!this.activeNode&&(r=this._lastMousedownNode||this.getFirstChild())&&r.setFocus())},treeSetOption:function(t,n,i){var r=t.tree,o=!0,s=!1,a=!1;switch(n){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":s=!0,a=!0;break;case"escapeTitles":case"tooltip":a=!0;break;case"rtl":!1===i?r.$container.removeAttr("DIR").removeClass("fancytree-rtl"):r.$container.attr("DIR","RTL").addClass("fancytree-rtl"),a=!0;break;case"source":o=!1,r._callHook("treeLoad",r,i),a=!0}r.debug("set option "+n+"="+i+" <"+typeof i+">"),o&&(this.widget._super?this.widget._super.call(this.widget,n,i):e.Widget.prototype._setOption.call(this.widget,n,i)),s&&r._callHook("treeCreate",r),a&&r.render(!0,!1)}}),e.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"slideToggle",duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new A(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul:first");var t,n,i,r=this.options,o=r.extensions;this.tree;for(i=0;i<o.length;i++)n=o[i],(t=e.ui.fancytree._extensions[n])||e.error("Could not apply extension '"+n+"' (it is not registered, did you forget to include it?)"),this.tree.options[n]=_({},t.options,this.tree.options[n]),b(void 0===this.tree.ext[n],"Extension name must not exist as Fancytree.ext attribute: '"+n+"'"),this.tree.ext[n]={},C(this.tree,0,t,n),t;void 0!==r.icons&&(!0!==r.icon?e.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),r.icon=r.icons)),void 0!==r.iconClass&&(r.icon?e.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),r.icon=r.iconClass)),void 0!==r.tabbable&&(r.tabindex=r.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+r.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),e.Widget.prototype.destroy.call(this)},_unbind:function(){var t=this.tree._ns;this.element.off(t),this.tree.$container.off(t),e(document).off(t)},_bind:function(){var t=this,n=this.options,r=this.tree,o=r._ns;this._unbind(),r.$container.on("focusin"+o+" focusout"+o,function(t){var n=i.getNode(t),o="focusin"===t.type;if(!o&&n&&e(t.target).is("a"))n.debug("Ignored focusout on embedded <a> element.");else{if(o){if(r._getExpiringValue("focusin"))return void r.debug("Ignored double focusin.");r._setExpiringValue("focusin",!0,50),n||(n=r._getExpiringValue("mouseDownNode"))&&r.debug("Reconstruct mouse target for focusin from recent event.")}n?r._callHook("nodeSetFocus",r._makeHookContext(n,t),o):r.tbody&&e(t.target).parents("table.fancytree-container > thead").length?r.debug("Ignore focus event outside table body.",t):r._callHook("treeSetFocus",r,o)}}).on("selectstart"+o,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+o,function(e){if(n.disabled||!1===n.keyboard)return!0;var t,i=r.focusNode,o=r._makeHookContext(i||r,e),s=r.phase;try{return r.phase="userEvent","preventNav"===(t=i?r._triggerNodeEvent("keydown",i,e):r._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=r._callHook("nodeKeydown",o)),t}finally{r.phase=s}}).on("mousedown"+o,function(e){var t=i.getEventTarget(e);r._lastMousedownNode=t?t.node:null,r._setExpiringValue("mouseDownNode",r._lastMousedownNode)}).on("click"+o+" dblclick"+o,function(e){if(n.disabled)return!0;var r,o=i.getEventTarget(e),s=o.node,a=t.tree,l=a.phase;if(!s)return!0;r=a._makeHookContext(s,e);try{switch(a.phase="userEvent",e.type){case"click":return r.targetType=o.type,s.isPagingNode()?!0===a._triggerNodeEvent("clickPaging",r,e):!1!==a._triggerNodeEvent("click",r,e)&&a._callHook("nodeClick",r);case"dblclick":return r.targetType=o.type,!1!==a._triggerNodeEvent("dblclick",r,e)&&a._callHook("nodeDblclick",r)}}finally{a.phase=l}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),i=e.ui.fancytree,e.extend(e.ui.fancytree,{version:"2.30.1",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:A,_FancytreeNodeClass:F,jquerySupports:{positionMyOfs:function(t,n,i,r){var o,s,a,l=e.map(e.trim(t).split("."),function(e){return parseInt(e,10)}),d=e.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)});for(o=0;o<d.length;o++)if((s=l[o]||0)!==(a=d[o]||0))return s>a;return!0}(e.ui.version,1,9)},assert:function(e,t){return b(e,t)},createTree:function(t,n){return e(t).fancytree(n).fancytree("getTree")},debounce:function(e,t,n,i){var r;return 3===arguments.length&&"boolean"!=typeof n&&(i=n,n=!1),function(){var o=arguments;i=i||this,n&&!r&&t.apply(i,o),clearTimeout(r),r=setTimeout(function(){n||t.apply(i,o),r=null},e)}},debug:function(t){e.ui.fancytree.debugLevel>=4&&x("log",arguments)},error:function(t){e.ui.fancytree.debugLevel>=1&&x("error",arguments)},escapeHtml:function(e){return(""+e).replace(o,function(e){return a[e]})},fixPositionOptions:function(t){if((t.offset||(""+t.my+t.at).indexOf("%")>=0)&&e.error("expected new position syntax (but '%' is not supported)"),!e.ui.fancytree.jquerySupports.positionMyOfs){var n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.my),i=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(t.at),r=(n[2]?+n[2]:0)+(i[2]?+i[2]:0),o=(n[4]?+n[4]:0)+(i[4]?+i[4]:0);t=e.extend({},t,{my:n[1]+" "+n[3],at:i[1]+" "+i[3]}),(r||o)&&(t.offset=r+" "+o)}return t},getEventTarget:function(t){var n,r=t&&t.target?t.target.className:"",o={node:this.getNode(t.target),type:void 0};return/\bfancytree-title\b/.test(r)?o.type="title":/\bfancytree-expander\b/.test(r)?o.type=!1===o.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(r)?o.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(r)?o.type="icon":/\bfancytree-node\b/.test(r)?o.type="title":t&&t.target&&((n=e(t.target)).is("ul[role=group]")?((o.node&&o.node.tree||i).debug("Ignoring click on outer UL."),o.node=null):n.closest(".fancytree-title").length?o.type="title":n.closest(".fancytree-checkbox").length?o.type="checkbox":n.closest(".fancytree-expander").length&&(o.type="expander")),o},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(t){if(t instanceof F)return t;for(t instanceof e?t=t[0]:void 0!==t.originalEvent&&(t=t.target);t;){if(t.ftnode)return t.ftnode;t=t.parentNode}return null},getTree:function(t){var n;return t instanceof A?t:(void 0===t&&(t=0),"number"==typeof t?t=e(".fancytree-container").eq(t):"string"==typeof t?t=e(t).eq(0):void 0!==t.selector?t=t.eq(0):void 0!==t.originalEvent&&(t=e(t.target)),(n=(t=t.closest(":ui-fancytree")).data("ui-fancytree")||t.data("fancytree"))?n.tree:null)},evalOption:function(t,n,i,r,o){var s,a,l=n.tree,d=r[t],c=i[t];return e.isFunction(d)?(s={node:n,tree:l,widget:l.widget,options:l.widget.options,typeInfo:l.types[n.type]||{}},null==(a=d.call(l,{type:t},s))&&(a=c)):a=null!=c?c:d,null==a&&(a=o),a},setSpanIcon:function(t,n,i){var r=e(t);"string"==typeof i?r.attr("class",n+" "+i):(i.text?r.text(""+i.text):i.html&&(t.innerHTML=i.html),r.attr("class",n+" "+(i.addClass||"")))},eventToString:function(e){var t=e.which,n=e.type,i=[];return e.altKey&&i.push("alt"),e.ctrlKey&&i.push("ctrl"),e.metaKey&&i.push("meta"),e.shiftKey&&i.push("shift"),"click"===n||"dblclick"===n?i.push(h[e.button]+n):l[t]||i.push(d[t]||String.fromCharCode(t).toLowerCase()),i.join("+")},info:function(t){e.ui.fancytree.debugLevel>=3&&x("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(t,n,i,r){var o,s=t[n]||e.noop;r=r||this,t[n]=function(){try{return o=r._super,r._super=s,i.apply(r,arguments)}finally{r._super=o}}},parseHtml:function(t){var n,i,r,o,s,a,l,d,c=t.find(">li"),h=[];return c.each(function(){var c,p,y=e(this),m=y.find(">span:first",this),b=m.length?null:y.find(">a:first"),x={tooltip:null,data:{}};for(m.length?x.title=m.html():b&&b.length?(x.title=b.html(),x.data.href=b.attr("href"),x.data.target=b.attr("target"),x.tooltip=b.attr("title")):(x.title=y.html(),(s=x.title.search(/<ul/i))>=0&&(x.title=x.title.substring(0,s))),x.title=e.trim(x.title),o=0,a=u.length;o<a;o++)x[u[o]]=void 0;for(n=this.className.split(" "),r=[],o=0,a=n.length;o<a;o++)i=n[o],f[i]?x[i]=!0:r.push(i);if(x.extraClasses=r.join(" "),(l=y.attr("title"))&&(x.tooltip=l),(l=y.attr("id"))&&(x.key=l),y.attr("hideCheckbox")&&(x.checkbox=!1),(c=T(y))&&!e.isEmptyObject(c)){for(p in v)c.hasOwnProperty(p)&&(c[v[p]]=c[p],delete c[p]);for(o=0,a=g.length;o<a;o++)l=g[o],null!=(d=c[l])&&(delete c[l],x[l]=d);e.extend(x.data,c)}(t=y.find(">ul:first")).length?x.children=e.ui.fancytree.parseHtml(t):x.children=x.lazy?void 0:null,h.push(x)}),h},registerExtension:function(t){b(null!=t.name,"extensions must have a `name` property."),b(null!=t.version,"extensions must have a `version` property."),e.ui.fancytree._extensions[t.name]=t},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(t){e.ui.fancytree.debugLevel>=2&&x("warn",arguments)}}),e.ui.fancytree}function b(t,n){t||(n=n?": "+n:"",e.error("Fancytree assertion failed"+n))}function x(e,t){var n,i,r=window.console?window.console[e]:null;if(r)try{r.apply(window.console,t)}catch(e){for(i="",n=0;n<t.length;n++)i+=t[n];r(i)}}function _(){var t,n,i,r,o,s=arguments[0]||{},a=1,l=arguments.length;if("object"==typeof s||e.isFunction(s)||(s={}),a===l)throw"need at least two args";for(;a<l;a++)if(null!=(t=arguments[a]))for(n in t)i=s[n],s!==(r=t[n])&&(r&&e.isPlainObject(r)?(o=i&&e.isPlainObject(i)?i:{},s[n]=_(o,r)):void 0!==r&&(s[n]=r));return s}function k(e,t,n,i,r){var o,s,a,l,d;return o=t[e],s=i[e],a=t.ext[r],l=function(){return o.apply(t,arguments)},d=function(e){return o.apply(t,e)},function(){var e=t._local,n=t._super,i=t._superApply;try{return t._local=a,t._super=l,t._superApply=d,s.apply(t,arguments)}finally{t._local=e,t._super=n,t._superApply=i}}}function C(t,n,i,r){for(var o in i)"function"==typeof i[o]?"function"==typeof t[o]?t[o]=k(o,t,0,i,r):"_"===o.charAt(0)?t.ext[r][o]=k(o,t,0,i,r):e.error("Could not override tree."+o+". Use prefix '_' to create tree."+r+"._"+o):"options"!==o&&(t.ext[r][o]=i[o])}function N(t,n){return void 0===t?e.Deferred(function(){this.resolve()}).promise():e.Deferred(function(){this.resolveWith(t,n)}).promise()}function S(t,n){return void 0===t?e.Deferred(function(){this.reject()}).promise():e.Deferred(function(){this.rejectWith(t,n)}).promise()}function w(e,t){return function(){e.resolveWith(t)}}function T(t){var n=e.extend({},t.data()),i=n.json;return delete n.fancytree,delete n.uiFancytree,i&&(delete n.json,n=e.extend(n,i)),n}function E(e){return(""+e).replace(s,function(e){return a[e]})}function I(e){return e=e.toLowerCase(),function(t){return t.title.toLowerCase().indexOf(e)>=0}}function F(t,n){var r,o,s,a;for(this.parent=t,this.tree=t.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},r=0,o=g.length;r<o;r++)this[s=g[r]]=n[s];for(s in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),n.hideCheckbox&&e.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),n.data&&e.extend(this.data,n.data),n)y[s]||e.isFunction(n[s])||m[s]||(this.data[s]=n[s]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),b(this.key,"defaultKey() must return a unique key")):this.key="_"+i._nextNodeKey++:this.key=""+this.key,n.active&&(b(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),n.selected&&(this.tree.lastSelectedNode=this),(a=n.children)?a.length?this._setChildren(a):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function A(t){this.widget=t,this.$div=t.element,this.options=t.options,this.options&&(e.isFunction(this.options.lazyload)&&!e.isFunction(this.options.lazyLoad)&&(this.options.lazyLoad=function(){return i.warn("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),t.options.lazyload.apply(this,arguments)}),e.isFunction(this.options.loaderror)&&e.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&i.warn("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode&&e.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10).")),this.ext={},this.types={},this.columns={},this.data=T(this.$div),this._id=e.ui.fancytree._nextId++,this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove();var n,r={tree:this};this.rootNode=new F(r,{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,n=e("<ul>",{class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=n,this.rootNode.ul=n[0],null==this.options.debugLevel&&(this.options.debugLevel=i.debugLevel)}e.ui.fancytree.warn("Fancytree: ignored duplicate include")}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(e){"use strict";var t=e.ui.fancytree.escapeHtml;function n(e){return(e+"").replace(/([.?*+\^\$\[\]\\(){}|-])/g,"\\$1")}return e.ui.fancytree._FancytreeClass.prototype._applyFilterImpl=function(i,r,o){var s,a,l,d,c,h=0,u=this.options,f=u.escapeTitles,p=u.autoCollapse,g=e.extend({},u.filter,o),y="hide"===g.mode,v=!!g.leavesOnly&&!r;if("string"==typeof i){if(""===i)return this.warn("Fancytree passing an empty string as a filter is handled as clearFilter()."),void this.clearFilter();s=g.fuzzy?i.split("").reduce(function(e,t){return e+"[^"+t+"]*"+t}):n(i),l=new RegExp(".*"+s+".*","i"),d=new RegExp(n(i),"gi"),i=function(n){if(!n.title)return!1;var i,r=f?n.title:(i=n.title).indexOf(">")>=0?e("<div/>").html(i).text():i,o=!!l.test(r);return o&&g.highlight&&(f?(c=r.replace(d,function(e){return"￷"+e+"￸"}),n.titleWithHighlight=t(c).replace(/\uFFF7/g,"<mark>").replace(/\uFFF8/g,"</mark>")):n.titleWithHighlight=r.replace(d,function(e){return"<mark>"+e+"</mark>"})),o}}return this.enableFilter=!0,this.lastFilterArgs=arguments,this.$div.addClass("fancytree-ext-filter"),y?this.$div.addClass("fancytree-ext-filter-hide"):this.$div.addClass("fancytree-ext-filter-dimm"),this.$div.toggleClass("fancytree-ext-filter-hide-expanders",!!g.hideExpanders),this.visit(function(e){delete e.match,delete e.titleWithHighlight,e.subMatchCount=0}),(a=this.getRootNode()._findDirectChild("__not_found__"))&&a.remove(),u.autoCollapse=!1,this.visit(function(e){if(!v||null==e.children){var t=i(e),n=!1;if("skip"===t)return e.visit(function(e){e.match=!1},!0),"skip";t||!r&&"branch"!==t||!e.parent.match||(t=!0,n=!0),t&&(h++,e.match=!0,e.visitParents(function(e){e.subMatchCount+=1,!g.autoExpand||n||e.expanded||(e.setExpanded(!0,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),e._filterAutoExpanded=!0)}))}}),u.autoCollapse=p,0===h&&g.nodata&&y&&(a=g.nodata,e.isFunction(a)&&(a=a()),!0===a?a={}:"string"==typeof a&&(a={title:a}),a=e.extend({statusNodeType:"nodata",key:"__not_found__",title:this.options.strings.noData},a),this.getRootNode().addNode(a).match=!0),this.render(),h},e.ui.fancytree._FancytreeClass.prototype.filterNodes=function(e,t){return"boolean"==typeof t&&(t={leavesOnly:t},this.warn("Fancytree.filterNodes() leavesOnly option is deprecated since 2.9.0 / 2015-04-19. Use opts.leavesOnly instead.")),this._applyFilterImpl(e,!1,t)},e.ui.fancytree._FancytreeClass.prototype.applyFilter=function(e){return this.warn("Fancytree.applyFilter() is deprecated since 2.1.0 / 2014-05-29. Use .filterNodes() instead."),this.filterNodes.apply(this,arguments)},e.ui.fancytree._FancytreeClass.prototype.filterBranches=function(e,t){return this._applyFilterImpl(e,!0,t)},e.ui.fancytree._FancytreeClass.prototype.clearFilter=function(){var t,n=this.getRootNode()._findDirectChild("__not_found__"),i=this.options.escapeTitles,r=this.options.enhanceTitle;n&&n.remove(),this.visit(function(n){n.match&&n.span&&(t=e(n.span).find(">span.fancytree-title"),i?t.text(n.title):t.html(n.title),r&&r({type:"enhanceTitle"},{node:n,$title:t})),delete n.match,delete n.subMatchCount,delete n.titleWithHighlight,n.$subMatchBadge&&(n.$subMatchBadge.remove(),delete n.$subMatchBadge),n._filterAutoExpanded&&n.expanded&&n.setExpanded(!1,{noAnimation:!0,noEvents:!0,scrollIntoView:!1}),delete n._filterAutoExpanded}),this.enableFilter=!1,this.lastFilterArgs=null,this.$div.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),this.render()},e.ui.fancytree._FancytreeClass.prototype.isFilterActive=function(){return!!this.enableFilter},e.ui.fancytree._FancytreeNodeClass.prototype.isMatched=function(){return!(this.tree.enableFilter&&!this.match)},e.ui.fancytree.registerExtension({name:"filter",version:"2.30.1",options:{autoApply:!0,autoExpand:!1,counter:!0,fuzzy:!1,hideExpandedCounter:!0,hideExpanders:!1,highlight:!0,leavesOnly:!1,nodata:!0,mode:"dimm"},nodeLoadChildren:function(e,t){return this._superApply(arguments).done(function(){e.tree.enableFilter&&e.tree.lastFilterArgs&&e.options.filter.autoApply&&e.tree._applyFilterImpl.apply(e.tree,e.tree.lastFilterArgs)})},nodeSetExpanded:function(e,t,n){return delete e.node._filterAutoExpanded,!t&&e.options.filter.hideExpandedCounter&&e.node.$subMatchBadge&&e.node.$subMatchBadge.show(),this._superApply(arguments)},nodeRenderStatus:function(t){var n,i=t.node,r=t.tree,o=t.options.filter,s=e(i.span).find("span.fancytree-title"),a=e(i[r.statusClassPropName]),l=t.options.enhanceTitle,d=t.options.escapeTitles;return n=this._super(t),a.length&&r.enableFilter?(a.toggleClass("fancytree-match",!!i.match).toggleClass("fancytree-submatch",!!i.subMatchCount).toggleClass("fancytree-hide",!(i.match||i.subMatchCount)),!o.counter||!i.subMatchCount||i.isExpanded()&&o.hideExpandedCounter?i.$subMatchBadge&&i.$subMatchBadge.hide():(i.$subMatchBadge||(i.$subMatchBadge=e("<span class='fancytree-childcounter'/>"),e("span.fancytree-icon, span.fancytree-custom-icon",i.span).append(i.$subMatchBadge)),i.$subMatchBadge.show().text(i.subMatchCount)),!i.span||i.isEditing&&i.isEditing.call(i)||(i.titleWithHighlight?s.html(i.titleWithHighlight):d?s.text(i.title):s.html(i.title),l&&l({type:"enhanceTitle"},{node:i,$title:s})),n):n}}),e.ui.fancytree}),function(e,t,n,i){"use strict";if(!e.ui.TreeType){var r=function(){this.initialize.apply(this,arguments)};r.prototype={initialize:function(t){var n=this;n.$widget=t,n.options=t.options,n.element=t.element,n.modalContentInitialized=!1,n.programmaticallyNodeSelection=!1,n.options.modalTitle=this.options.modalTitle||null,n.options.typeId=this.element.attr("id"),n.options.treeData=this.options.treeData||this.element.attr("json-data")||null,n.options.modalId=this.options.typeId+"_modal",n.options.treeId=this.options.treeId||this.options.typeId+"_container",n.options.treeSearchId=this.options.typeId+"_treeSearch",n.options.treeUnmatchedId=this.options.typeId+"_treeUnmatched",n.options.treeSelectHierarchyId=this.options.typeId+"_treeSelectHierarchy",n.options.modalOkBtnClass=this.options.typeId+"_category-modal-ok-btn",n.options.modalResetBtnClass=this.options.typeId+"_category-modal-reset-btn",n.options.modalCancelBtnClass=this.options.typeId+"_category-modal-cancel-btn",n.options.selectMode=1==n.options.selectHierarchyChecked?3:n.options.selectMode,(e("#"+n.options.selectId).is(":disabled")||"readonly"==e("#"+n.options.selectId).attr("readonly"))&&(n.options.selectOnlyLeaves=!0),e("#"+n.options.selectId).is(":disabled")&&(n.element.attr("disabled","disabled"),n.element.next().attr("disabled","disabled")),n._constructModal.call(n),n._updateInfo(),n.element.off("click").on("click",function(e){e.target==this&&n.modal.show()}),n.element.next().off("click").on("click",function(e){n.modal.show()}),e("#"+n.options.selectId).on("change",function(){n._updateInfo(),null!=n.$tree&&n._syncSelectToTree()}),e("#"+n.options.typeId).parents("form").on("reset",function(){e("#"+n.options.selectId+' option[value!=""]:selected').removeAttr("selected").prop("selected",!1),null!=n.$tree&&(n._resetSearch(),n._syncSelectToTree()),n._updateInfo()})},_constructModal:function(){var t=this,i=t.options.searchUnmatched?'checked="checked"':"",r=t.options.selectHierarchyChecked?'checked="checked"':"",o="",s='<div class="row no-item-matched hidden"><div class="col-lg-12"><div class="alert alert-info text-center no-margin-top-bottom">'+t.options.noResults+"</div></div></div>",a='<div class="row"><div class="col-lg-12"><div><label for="'+t.options.treeSearchId+'">'+t.options.searchPlaceholder+'</label><div class="input-group input-group-no-separation"><input type="text" id="'+t.options.treeSearchId+'" class="form-control"><span class="input-group-addon"><i class="fa fa-search"></i></span></div></div></div></div><div class="row"><div class="col-lg-6"><div class="checkbox"><label><input type="checkbox" id="'+this.options.treeUnmatchedId+'" '+i+' class="form-checkbox-control" /> '+t.options.textUnmatched+" </label></div></div>";0==t.options.selectOnlyLeaves&&(a+='<div class="col-lg-6"><div class="checkbox"><label><input type="checkbox" id="'+this.options.treeSelectHierarchyId+'" '+r+' class="form-checkbox-control" /> '+t.options.textSelectHierarchy+" </label></div></div>"),e("#"+t.options.selectId).is(":disabled")&&(o=' class="fancytree-disabled"'),a+='</div><div class="row"><div class="col-lg-12"><div id="'+t.options.treeId+'"'+o+"></div></div></div>"+s,t.modal=new PhotonModal({id:t.options.modalId,type:"preview",recreateOnShow:!1,title:t.options.modalTitle,content:a,buttons:{reset:{label:t.options.modalResetLabel,class:"btn-default pull-left "+t.options.modalResetBtnClass},cancel:{label:t.options.modalCancelLabel,class:"btn-default pull-right "+t.options.modalCancelBtnClass,closeModal:!0},ok:{label:t.options.modalOkLabel,class:"btn-primary pull-right "+t.options.modalOkBtnClass,closeModal:!0}},showCallback:function(){t.modalContentInitialized?t._syncSelectToTree():(e("#"+t.options.modalId).find(".panel-controls").css("width","100%"),t._constructTree(),t.options.searchable&&t._constructSearch(),t.modalContentInitialized=!0)},hideCallback:function(){t._syncSelectToTree()}}),e("body").off("click","."+t.options.modalResetBtnClass).on("click","."+t.options.modalResetBtnClass,function(n){e(".fancytree-visibility-none").removeClass("fancytree-visibility-none"),t._syncSelectToTree()}),e("body").off("click","."+t.options.modalOkBtnClass).on("click","."+t.options.modalOkBtnClass,function(n){e(".fancytree-visibility-none").removeClass("fancytree-visibility-none"),t.$tree.visit(function(e){t._addCollapseIcon(e)}),t._updateElement()}),e("body").off("click","."+t.options.modalCancelBtnClass).on("click","."+t.options.modalCancelBtnClass,function(n){e(".fancytree-visibility-none").removeClass("fancytree-visibility-none"),t.$tree.visit(function(e){t._addCollapseIcon(e)})}),e(n).keyup(function(n){27==n.keyCode&&t.$tree&&(e(".fancytree-visibility-none").removeClass("fancytree-visibility-none"),t.$tree.visit(function(e){t._addCollapseIcon(e)}),t.modal.hide())})},_constructTree:function(){var t=this;t.options.useAjax?t.tree=e("#"+t.options.treeId).fancytree({extensions:["filter"],source:t.options.treeData,checkbox:!0,icon:!1,toggleEffect:!1,activeVisible:!0,debugLevel:0,selectMode:t.options.selectMode,beforeSelect:function(e,n){return t._beforeNodeSelection()},select:function(e,n){t._nodeSelection(e,n)},lazyLoad:function(e,n){var i=n.node;n.result={url:t.options.ajaxRoute,data:{key:i.key}}}}):t.tree=e("#"+t.options.treeId).fancytree({extensions:["filter"],source:t.options.treeData,checkbox:!0,icon:!1,toggleEffect:!1,activeVisible:!0,debugLevel:0,selectMode:t.options.selectMode,beforeSelect:function(e,n){return t._beforeNodeSelection()},select:function(e,n){t._nodeSelection(e,n)}}),t.$tree=t.tree.fancytree("getTree"),e(n).on("hidden.bs.modal",function(){e(".fancytree-visibility-none").removeClass("fancytree-visibility-none"),t.$tree.visit(function(e){t._addCollapseIcon(e)})}),t._syncSelectToTree()},_constructSearch:function(){var t=this;t.$tree.options.filter.mode=t.options.searchUnmatched?"hide":"dimm",e("#"+t.options.treeSearchId).off("input").on("input",function(e){t._searchHandler.call(t)}),e("#"+t.options.treeSelectHierarchyId).off("change").on("change",function(){e(this).is(":checked")?(t.tree.fancytree("option","selectMode",3),t.$tree.visit(function(e){1==e.selected&&(t.programmaticallyNodeSelection=!0,e.setSelected(!1),e.setSelected(!0),t.programmaticallyNodeSelection=!1)})):(t.tree.fancytree("option","selectMode",2),t.$tree.visit(function(e){e.partsel&&(e.partsel=!1,e.render(!0))}))}),e("#"+t.options.treeUnmatchedId).off("change").on("change",function(){t._unmatchedHandler.call(t)})},_syncSelectToTree:function(){var t=this;t._resetSearch();var n=t.$tree.getSelectedNodes();e(n).each(function(n,i){t.programmaticallyNodeSelection=!0;var r=i.getParentList();e(r).each(function(e,t){t.setExpanded(!1,{noAnimation:!1})}),i.setSelected(!1),t.programmaticallyNodeSelection=!1}),e("#"+t.options.selectId+" option:selected").each(function(){var n=e(this).val(),i=t.$tree.getNodeByKey(n);i&&(t.programmaticallyNodeSelection=!0,i.setSelected(!0),i.makeVisible({noAnimation:!0,noEvents:!1,scrollIntoView:!1}),t.programmaticallyNodeSelection=!1)})},_updateInfo:function(){var t=e("#"+this.options.selectId+' option[value!=""]:selected').length+" "+this.options.textSelected;this.element.html(t)},_updateElement:function(){var t=this,n=t.$tree.getSelectedNodes();e("#"+t.options.selectId+" option:selected").removeAttr("selected"),e("#"+t.options.selectId+" option:selected").prop("selected",!1),e(n).each(function(){0==e("#"+t.options.selectId+' option[value="'+this.key+'"]').length&&e("<option/>",{value:this.key,html:this.title}).appendTo("#"+t.options.selectId),e("#"+t.options.selectId+' option[value="'+this.key+'"]').prop("selected",!0)}),e("#"+t.options.selectId).trigger("change")},_addCollapseIcon:function(e){if(null!=e.extraClasses&&-1!=e.extraClasses.indexOf("fancytree-visibility-none")){var t=e.extraClasses.replace("fancytree-visibility-none","");e.extraClasses=t,e.render(!0)}},_beforeNodeSelection:function(){if(!this.programmaticallyNodeSelection&&(e("#"+this.options.selectId).is(":disabled")||"readonly"==e("#"+this.options.selectId).attr("readonly")))return!1},_nodeSelection:function(e,t){this._checkPartialSelection(e,t),this._uncheckUncheckebleNodes()},_checkPartialSelection:function(t,n){if(0==n.node.selected){n.node.partsel=!1,n.node.render(!0);var i=n.node.getParentList(!1,n.node.hasChildren());e.each(i,function(t,n){if(!n.selected){var i=!1;e.each(n.children,function(e,t){if(t.selected)return i=!0,!1}),0==i&&(n.partsel=!1,n.render(!0))}})}},_uncheckUncheckebleNodes:function(){this.$tree.visit(function(e){!0===e.unselectable&&!0===e.selected&&(e.selected=!1,e.partsel=!1,e.renderStatus())})},_unmatchedHandler:function(){this.options.searchUnmatched=e("#"+this.options.treeUnmatchedId).is(":checked"),this.$tree.options.filter.mode=this.options.searchUnmatched?"hide":"dimm",this.$tree.clearFilter(),e("#"+this.options.treeSearchId).trigger("input"),0==e("#"+this.options.treeSearchId).val().length&&(e("#"+this.options.treeId).removeClass("fancytree-ext-filter fancytree-ext-filter-dimm"),e("#"+this.options.treeId).find(".fancytree-visibility-none").removeClass("fancytree-visibility-none"))},_resetSearch:function(){0!==e("#"+this.options.treeSearchId).length&&e("#"+this.options.treeSearchId).val(""),this.$tree.clearFilter(),e("#"+this.options.treeUnmatchedId).length&&(e("#"+this.options.treeUnmatchedId).prop("checked",!0),this._unmatchedHandler())},_searchHandler:function(){var t=this,n=e("#"+t.options.treeSearchId).val().trim();if(t.options.useAjax&&""!=t.options.searchAjaxRoute)if(n.length>=2){e.getJSON(t.options.searchAjaxRoute,{search:n},function(n){if(n.search==e("#"+t.options.treeSearchId).val().trim())for(var i=0;i<n.data.length;i++){var r=n.data[i];if(null==t.$tree.getNodeByKey(r.key.toString())){var o=t.$tree.getNodeByKey(r.parentId.toString());if(null!=o){var s={key:r.key,title:r.title,selected:!1,extraClasses:"tree-inactive-item",folder:!1,lazy:!1,children:[]};"active"==r.status&&(s.extraClasses=""),r.leaf>1&&(s.folder=!0,s.lazy=!0),o.addChildren(s)}}}t._searchHandlerAction()})}else 1==n.length?(this.$tree.filterNodes(function(e){return!0}),t.tree.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),t.tree.find(".fancytree-visibility-none").removeClass("fancytree-visibility-none")):t._searchHandlerAction();else t._searchHandlerAction()},_searchHandlerAction:function(){var t=this,n=e("#"+t.options.treeSearchId).val().trim().toLowerCase();e(".fancytree-visibility-none").removeClass("fancytree-visibility-none");var i=this.$tree.filterNodes(function(i){t._addCollapseIcon(i);var r=-1!=i.title.toLowerCase().indexOf(n);if(1==r)if("dimm"!=t.$tree.options.filter.mode){var o=0;i.setExpanded(!1,{noAnimation:!1}),i.children&&i.visit(function(e){(e.isVisible()||-1!=e.title.toLowerCase().indexOf(n))&&o++}),0==o&&0!=n.length&&(null!=i.extraClasses&&-1!=i.extraClasses.indexOf("fancytree-visibility-none")||(i.extraClasses+=" fancytree-visibility-none"))}else e(".fancytree-visibility-none").removeClass("fancytree-visibility-none");return r}),r=e("#"+t.options.modalId),o=e("#"+t.options.treeId),s=e("."+t.options.modalOkBtnClass),a=e("#"+t.options.treeUnmatchedId).is(":checked");0===i&&a?(r.find(".no-item-matched").removeClass("hidden"),o.addClass("hidden"),s.attr("disabled",!0)):(r.find(".no-item-matched").addClass("hidden"),o.removeClass("hidden"),s.attr("disabled",!1)),0==n.length&&(t.tree.removeClass("fancytree-ext-filter fancytree-ext-filter-dimm fancytree-ext-filter-hide"),t.tree.find(".fancytree-visibility-none").removeClass("fancytree-visibility-none"))},destroy:function(){this.tree&&this.tree.fancytree("destroy"),e("#"+this.options.modalId).remove(),e(this.element).off("click"),e(this.element).html("")}},e.widget("ui.TreeType",{options:{modalTitle:"Selectează",noResults:"Nici un rezultat găsit",modalResetLabel:"Resetează",modalCancelLabel:"Anulează",modalOkLabel:"Selectează",textUnmatched:"Ascunde rezultatele nerelevante",textSelectHierarchy:"Selectare multiplă ierarhică",textSelected:"selectate",searchPlaceholder:"Caută",typeId:null,treeData:null,selectId:null,treeId:null,selectMode:2,searchable:!0,searchUnmatched:!0,selectHierarchyChecked:!1,selectOnlyLeaves:!1,useAjax:!1,ajaxRoute:"",searchAjaxRoute:""},_create:function(){this.TreeType=new r(this)},_destroy:function(){this.TreeType&&this.TreeType.destroy()},treeData:function(e){if(void 0===e)return this.options.treeData;this.TreeType.options.treeData=e,this.TreeType.tree&&(this.TreeType.tree.fancytree("destroy"),this.TreeType._constructTree())}})}}(jQuery,window,document);